{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://multi-agent-orchestrator.dev/schemas/icnp/execution-token.schema.json",
  "title": "ICNP Execution Token Schema",
  "description": "Schema for execution tokens that govern runtime behavior in ICNP",
  "type": "object",
  "required": [
    "icnp_version",
    "phase",
    "token_id",
    "contract_id",
    "token",
    "validity",
    "binding",
    "enforcement"
  ],
  "properties": {
    "icnp_version": {
      "type": "string",
      "pattern": "^[0-9]+\\.[0-9]+$"
    },
    "phase": {
      "type": "string",
      "const": "execution_token"
    },
    "token_id": {
      "type": "string",
      "format": "uuid"
    },
    "contract_id": {
      "type": "string",
      "format": "uuid"
    },
    "token": {
      "type": "string",
      "description": "JWT or similar cryptographic token"
    },
    "validity": {
      "$ref": "#/definitions/Validity"
    },
    "binding": {
      "$ref": "#/definitions/Binding"
    },
    "enforcement": {
      "$ref": "#/definitions/Enforcement"
    }
  },
  "definitions": {
    "Validity": {
      "type": "object",
      "required": ["not_before", "not_after"],
      "properties": {
        "not_before": {
          "type": "string",
          "format": "date-time"
        },
        "not_after": {
          "type": "string",
          "format": "date-time"
        },
        "max_invocations": {
          "type": "integer",
          "minimum": 1
        }
      }
    },
    "Binding": {
      "type": "object",
      "required": ["intent_hash", "contract_hash"],
      "properties": {
        "intent_hash": {
          "type": "string",
          "description": "SHA-256 hash of the original intent"
        },
        "contract_hash": {
          "type": "string",
          "description": "SHA-256 hash of the agreed contract"
        },
        "capability_hashes": {
          "type": "array",
          "items": { "type": "string" },
          "description": "SHA-256 hashes of each agreed capability"
        }
      }
    },
    "Enforcement": {
      "type": "object",
      "required": ["mode"],
      "properties": {
        "mode": {
          "type": "string",
          "enum": ["strict", "permissive", "audit-only"],
          "default": "strict"
        },
        "violation_action": {
          "type": "string",
          "enum": ["abort", "abort_and_rollback", "warn", "log"],
          "default": "abort_and_rollback"
        },
        "alert_on_violation": {
          "type": "boolean",
          "default": true
        }
      }
    }
  }
}
